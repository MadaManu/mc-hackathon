var client = require("./_client-helper"),
	assert = require('assert');

describe('Customer -', function() {

	it('should create a customer successfully', function(done) {
		client.customer.create({
			email: "customer@mastercard.com",
			name: "Customer Customer",
			card: {
				expMonth: "11",
				expYear: "19",
				cvc: "123",
				number: "5555555555554444"
			},
			reference: "Ref1"
		}, function(error, data) {

			if (error) {
				console.error(JSON.stringify(error.data));
				done(error);
			}

			assert.equal(data.name, "Customer Customer", "Create a new customer should succeed");
			done();
		});
	});

	it('should delete a customer successfully', function(done) {
		client.customer.create({
			email: "customer@mastercard.com",
			name: "Customer Customer",
			card: {
				expMonth: "11",
				expYear: "19",
				cvc: "123",
				number: "5555555555554444"
			},
			reference: "Ref1"
		}, function(error, data) {

			if (error) {
				console.error(JSON.stringify(error.data));
				done(error);
			}

			// Use id of newly created customer to execute 'delete' request
			client.customer.delete(data.id, function(deleteError, deleteData) {

				if (deleteError) {
					console.error(JSON.stringify(deleteError.data));
					done(deleteError);
				}

				assert.equal(deleteData.id, data.id, "Deletetion of customer with ID '" + data.id + "' should succeed");
				done();
			});
		});
	});

	it('should retrieve a list of customers successfully', function(done) {
		client.customer.list({
			max: 30
		}, function(error, data) {

			if (error) {
				console.error(JSON.stringify(error.data));
				done(error);
			}

			assert.equal(data.max, 30, "Retrieve a list of customers should succeed");
			done();
		});
	});

	it('should find a customer successfully', function(done) {
		client.customer.create({
			email: "customer@mastercard.com",
			name: "Customer Customer",
			card: {
				expMonth: "11",
				expYear: "19",
				cvc: "123",
				number: "5555555555554444"
			},
			reference: "Ref1"
		}, function(error, data) {

			if (error) {
				console.error(JSON.stringify(error.data));
				done(error);
			}

			// Use id of newly created customer to execute 'find' request
			client.customer.find(data.id, function(findError, findData) {

				if (findError) {
					console.error(JSON.stringify(findError.data));
					done(findError);
				}

				assert.equal(findData.id, data.id, "Find a customer with ID '" + data.id + "' should succeed");
				done();
			});
		});
	});

	it('update a customer successfully', function(done) {
		client.customer.create({
			email: "customer@mastercard.com",
			name: "Customer Customer",
			card: {
				expMonth: "11",
				expYear: "19",
				cvc: "123",
				number: "5555555555554444"
			},
			reference: "Ref1"
		}, function(error, data) {

			if (error) {
				console.error(JSON.stringify(error.data));
				done(error);
			}

			// Use id of newly created customer to execute 'update' request
			client.customer.update({
				id: data.id,
				email: "updated@mastercard.com",
				name: "Updated Customer Name",
				card: {
					expMonth: "5",
					expYear: "15",
					cvc: "456",
					number: "5120790000000083"
				},
				reference: "Ref11"
			}, function(updateError, updateData) {

				if (updateError) {
					console.error(JSON.stringify(updateError.data));
					done(updateError);
				}

				assert.equal(updateData.email, "updated@mastercard.com", "Update Customer with ID '" + data.id + "' should succeed");
				done();
			});
		});
	});

});