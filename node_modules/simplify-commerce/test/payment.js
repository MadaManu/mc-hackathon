var client = require("./_client-helper"),
	assert = require('assert');

describe('Payment -', function() {

	it('should create a payment successfully', function(done) {
		client.payment.create({
			amount: "123123",
			description: "payment description",
			card: {
				expMonth: "11",
				expYear: "19",
				cvc: "123",
				number: "5555555555554444"
			},
			currency: "USD"
		}, function(error, data) {

			if (error) {
				console.error(JSON.stringify(error.data));
				done(error);
			}

			assert.equal(data.paymentStatus, "APPROVED", "Create Payment fails with correct error code.");
			done();
		});
	});

	it('should retrieve a list of payments successfully', function(done) {
		client.payment.list({
			max: 30
		}, function(error, data) {

			if (error) {
				console.error(JSON.stringify(error.data));
				done(error);
			}

			assert.equal(data.max, 30, "List Payment should succeed");
			done();
		});
	});

	it('should find a payment successfully', function(done) {
		client.payment.create({
			amount: "123123",
			description: "payment description",
			card: {
				expMonth: "11",
				expYear: "19",
				cvc: "123",
				number: "5555555555554444"
			},
			currency: "USD"
		}, function(error, data) {

			if (error) {
				console.error(JSON.stringify(error.data));
				done(error);
			}

			// Use id of newly created payment to execute 'find' request
			client.payment.find(data.id, function(error, findData) {

				if (error) {
					console.error(JSON.stringify(error.data));
					done(error);
				}

				assert.equal(findData.id, data.id, "Find Payment with ID '" + data.id + "' should succeed");
				done();
			});
		});
	});

});